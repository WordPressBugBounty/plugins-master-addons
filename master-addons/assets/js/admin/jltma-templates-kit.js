jQuery(document).ready(function(t){"use strict";var e={requiredTheme:!1,requiredPlugins:!1,lazyImages:[],currentPage:1,isLoading:!1,hasMoreTemplates:!0,init:function(){t(document).on("click",".jltma-templates-kit-grid .image-overlay",function(){e.showImportPage(t(this).closest(".grid-item")),e.renderImportPage(t(this).closest(".grid-item"))}),t(".jltma-templates-kit-logo").find(".back-btn").on("click",function(){e.showTemplatesMainGrid()}),t(".jltma-templates-kit-single").find(".import-kit").on("click",function(){if("pro"===t(".jltma-templates-kit-grid").find('.grid-item[data-kit-id="'+t(this).attr("data-kit-id")+'"]').data("price"))return!1;if(confirm("For the best results, it is recommended to temporarily deactivate All other Active plugins Except Elementor and Master Addons.\n\nHere's what will be imported: posts, pages, images in the media library, menu items, some basic settings (like which page will be the homepage), and any pre-made headers, footers, and pop-ups if the Template Kit includes them. You can always delete this imported content and return to your old site design. \n\nDon't worryâ€”none of your current data, like images, posts, pages, menus and anything else, won't be deleted.")){e.importTemplatesKit(t(this).attr("data-kit-id")),t(".jltma-import-kit-popup-wrap").fadeIn();var a=t('.grid-item[data-kit-id="'+t(this).attr("data-kit-id")+'"]').find(".jltma-woo-builder-label").length,i=t(".jltma-wp-update-notice").length;a>0&&i>0&&(t(".jltma-wp-update-notice").show(),t(".progress-wrap").hide())}}),t(".jltma-templates-kit-single").find(".show-kit-templates").on("click",function(){var a=t(".jltma-templates-kit-single .import-kit").attr("data-kit-id");e.showKitTemplates(a)}),t(document).on("click",".import-selected",function(){e.importSelectedTemplates()}),t(document).on("change","#select-all-templates",function(){var a=t(this).prop("checked");t(".template-item-checkbox").prop("checked",a),e.updateSelectedCount()}),t(document).on("change",".template-item-checkbox",function(){e.updateSelectedCount()}),t(".jltma-import-kit-popup-wrap").find(".close-btn").on("click",function(){t(".jltma-import-kit-popup-wrap").fadeOut(),window.location.reload()});var a=null,i=t(".jltma-templates-kit-grid").html();t(".jltma-templates-kit-search").find("input").keyup(function(s){if(13===s.which)return!1;var n=t(this).val().toLowerCase();null!=a&&clearTimeout(a),a=setTimeout(function(){a=null,e.searchTemplatesKit(n,i),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_search_query_results",search_query:n},success:function(t){}})},1e3)}),t(".jltma-templates-kit-price-filter ul li").on("click",function(){var a="premium"==(a=t(this).text()).toLowerCase()?"pro":a.toLowerCase();e.fiterFreeProTemplates(a),t(".jltma-templates-kit-price-filter").children().first().attr("data-price",a),t(".jltma-templates-kit-price-filter").children().first().text("Price: "+t(this).text())}),e.initializeLazyLoading(),e.initializeCacheControls(),e.initializeIconFallback(),e.initializeInfiniteScroll()},initializeIconFallback:function(){t(".jltma-refresh-cache").each(function(){var e=t(this),a=e.find(".eicon-sync"),i=e.find(".dashicons");if(a.length){var s=t('<i class="eicon-sync" style="font-family: eicons; position: absolute; left: -9999px;">').appendTo("body"),n=s.css("font-family");s.remove(),-1!==n.indexOf("eicons")?(e.addClass("eicon-loaded"),i.hide()):(i.show(),a.hide())}})},initializeCacheControls:function(){t(document).on("click",".cache-actions .button",function(t){t.preventDefault(),e.refreshCache()}),t(document).on("click","#ma-el-template-cache-refresh",function(t){t.preventDefault(),e.refreshTemplateCache()})},refreshCache:function(){var e=t(".cache-actions .button"),a=e.html();e.html('<span class="dashicons dashicons-update"></span>').addClass("updating"),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_refresh_template_kit_cache",_wpnonce:JLTMATemplatesKitLoc.cache_nonce},success:function(i){if(i.success){t(".cache-info span:last-child").text("Cached: "+i.data.total_kits+" kits"),e.html(a).removeClass("updating");var s=t('<div class="notice notice-success is-dismissible"><p>Cache refreshed successfully!</p></div>');t(".jltma-templates-kit-page-title").after(s),setTimeout(function(){s.fadeOut()},3e3)}},error:function(){e.html(a).removeClass("updating")}})},refreshTemplateCache:function(){var e=t("#ma-el-template-cache-refresh"),a=e.find("i");e.addClass("updating"),a.removeClass("eicon-sync").addClass("eicon-loading eicon-animation-spin"),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_refresh_templates_cache",_wpnonce:JLTMATemplatesKitLoc.cache_nonce},success:function(i){if(i.success){var s=t("#ma-el-template-cache-status");if(s.length){var n=i.data.total_templates||0;n>0?(s.find(".cache-count").text(n),s.show()):s.hide()}e.removeClass("updating"),a.removeClass("eicon-loading eicon-animation-spin").addClass("eicon-sync"),"undefined"!=typeof elementor&&elementor.templates&&elementor.templates.refresh()}},error:function(){e.removeClass("updating"),a.removeClass("eicon-loading eicon-animation-spin").addClass("eicon-sync")}})},installRequiredTheme:function(a){var i=t(".jltma-templates-kit-grid").data("theme-status");if("req-theme-active"!==i)return"req-theme-inactive"===i?(t.post(ajaxurl,{action:"jltma_activate_required_theme",nonce:JLTMATemplatesKitLoc.nonce}),void(e.requiredTheme=!0)):void wp.updates.installTheme({slug:"hello-elementor",success:function(){t.post(ajaxurl,{action:"jltma_activate_required_theme",nonce:JLTMATemplatesKitLoc.nonce}),e.requiredTheme=!0}});e.requiredTheme=!0},installRequiredPlugins:function(a){e.installRequiredTheme();var i=t('.grid-item[data-kit-id="'+a+'"]');e.requiredPlugins=void 0!==i.data("plugins")&&i.data("plugins"),e.requiredPlugins&&("contact-form-7"in e.requiredPlugins&&!1===e.requiredPlugins["contact-form-7"]&&e.installPluginViaAjax("contact-form-7"),"woocommerce"in e.requiredPlugins&&!1===e.requiredPlugins.woocommerce&&e.installPluginViaAjax("woocommerce"),"elementor"in e.requiredPlugins&&!1===e.requiredPlugins.elementor&&e.installPluginViaAjax("elementor"))},installPluginViaAjax:function(a){wp.updates.installPlugin({slug:a,success:function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_activate_required_plugins",plugin:a,nonce:JLTMATemplatesKitLoc.nonce},success:function(t){e.requiredPlugins[a]=!0},error:function(t){e.requiredPlugins[a]=!0}})},error:function(i,s,n){"folder_exists"===i.errorCode&&t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_activate_required_plugins",plugin:a,nonce:JLTMATemplatesKitLoc.nonce},success:function(t){e.requiredPlugins[a]=!0}})}})},maFixCompatibility:function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_fix_compatibility",nonce:JLTMATemplatesKitLoc.nonce},success:function(t){console.log("Plugins compatibility fixed successfully!")},error:function(t){console.log("No plugins compatibility issues!")}})},importTemplatesKit:function(a){e.importProgressBar("plugins"),e.installRequiredPlugins(a),e.maFixCompatibility();var i=setInterval(function(){Object.values(e.requiredPlugins).every(Boolean)&&e.requiredTheme&&(t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_reset_previous_import",nonce:JLTMATemplatesKitLoc.nonce},success:function(i){e.importProgressBar("content"),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_import_templates_kit",nonce:JLTMATemplatesKitLoc.nonce,jltma_templates_kit:a,jltma_templates_kit_single:!1},success:function(a){if(void 0!==a.success)return t(".progress-wrap, .jltma-import-help").addClass("import-error"),t(".jltma-import-help a").attr("href",t(".jltma-import-help a").attr("href")+"-xml-"+a.data.problem+"-failed"),t(".progress-wrap").find("strong").html(a.data.error+"<br><span>"+a.data.help+"<span>"),t(".jltma-import-help a").html('Contact Support <span class="dashicons dashicons-email"></span>'),!1;e.importProgressBar("settings"),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_final_settings_setup",nonce:JLTMATemplatesKitLoc.nonce},success:function(t){setTimeout(function(){e.importProgressBar("finish")},1e3)},error:function(t,e,a){console.error("AJAX-error:",e,a)}})},error:function(t,e,a){console.error("AJAX-error:",e,a)}})}}),clearInterval(i))},1e3)},importSingleTemplate:function(e,a){t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_import_templates_kit",nonce:JLTMATemplatesKitLoc.nonce,jltma_templates_kit:e,jltma_templates_kit_single:a},success:function(t){console.log(t)}})},importProgressBar:function(e){if("plugins"===e)t(".jltma-import-kit-popup .progress-wrap strong").html('Step 1: Installing/Activating Plugins<span class="dot-flashing"></span>');else if("content"===e)t(".jltma-import-kit-popup .progress-bar").animate({width:"33%"},500),t(".jltma-import-kit-popup .progress-wrap strong").html('Step 2: Importing Demo Content<span class="dot-flashing"></span>');else if("settings"===e)t(".jltma-import-kit-popup .progress-bar").animate({width:"66%"},500),t(".jltma-import-kit-popup .progress-wrap strong").html('Step 3: Importing Settings<span class="dot-flashing"></span>');else if("finish"===e){var a=window.location.href,i=a.indexOf("/wp-admin"),s=a.substring(0,i);t(".jltma-import-kit-popup .progress-bar").animate({width:"100%"},500),t(".jltma-import-kit-popup .content").children("p").remove(),t(".jltma-import-kit-popup .progress-wrap").before('<p>Your Template Kit has been successfully imported! You can now <strong><a href="'+s+'" target="_blank">Visit your Site</a></strong> to see the changes or <strong><a href="admin.php?page=master-addons-settings">configure Master Addons</a></strong> settings.</p>'),t(".jltma-import-kit-popup .progress-wrap strong").html('Step 4: Import Completed Successfully - <a href="'+s+'" target="_blank">Visit Site</a>'),t(".jltma-import-kit-popup header h3").text("Import was Successful!"),t(".jltma-import-kit-popup-wrap .close-btn").show()}},showTemplatesMainGrid:function(){t(this).hide(),t(".jltma-templates-kit-single").hide(),t(".jltma-templates-kit-page-title").show(),t(".jltma-templates-kit-grid.main-grid").show(),t(".jltma-templates-kit-search").show(),t(".jltma-templates-kit-price-filter").show(),t(".jltma-templates-kit-logo").find(".back-btn").css("display","none")},showImportPage:function(e){t(".jltma-templates-kit-page-title").hide(),t(".jltma-templates-kit-grid.main-grid").hide(),t(".jltma-templates-kit-search").hide(),t(".jltma-templates-kit-price-filter").hide(),t(".jltma-templates-kit-single .action-buttons-wrap").css("margin-left",t("#adminmenuwrap").outerWidth()),t(".jltma-templates-kit-single").show(),t(".jltma-templates-kit-logo").find(".back-btn").css("display","flex"),t(".jltma-templates-kit-single .preview-demo").attr("href","https://demosites.master-addons.com/"+e.data("kit-id")+"?ref=ma-plugin-backend-templates"),!0===e.data("expert")?t(".jltma-templates-kit-expert-notice").show():t(".jltma-templates-kit-expert-notice").hide()},renderImportPage:function(a){var i=a.data("kit-id"),s=void 0!==a.data("pages")&&a.data("pages"),n=!!s&&s.split(","),l=t(".jltma-templates-kit-grid.single-grid");if(l.html(""),n)for(var o=0;o<n.length;o++)l.append('                        <div class="grid-item">                            <a href="https://demosites.master-addons.com/'+a.data("kit-id")+'?ref=ma-plugin-backend-templates" target="_blank">                            <div class="image-wrap">                                <img src="https://master-addons.com/templates-kit/'+i+"/"+n[o]+'.jpg">                            </div>                            <footer><h3>'+n[o]+"</h3></footer>                            </a>                        </div>                    ");"pro"===t(".jltma-templates-kit-grid").find('.grid-item[data-kit-id="'+a.data("kit-id")+'"]').data("price")?(t(".jltma-templates-kit-single").find(".import-kit").hide(),t(".jltma-templates-kit-single").find(".get-access").show()):(t(".jltma-templates-kit-single").find(".get-access").hide(),t(".jltma-templates-kit-single").find(".import-kit").show(),t(".jltma-templates-kit-single").find(".import-kit").attr("data-kit-id",a.data("kit-id"))),e.initializeLazyLoading()},initializeLazyLoading:function(){var e=t("img.lazy");if("IntersectionObserver"in window){var a=new IntersectionObserver(function(e,i){e.forEach(function(e){if(e.isIntersecting){var i=t(e.target);i.attr("src",i.data("src")),i.removeClass("lazy"),a.unobserve(e.target)}})});e.each(function(){a.observe(this)})}else{var i,s=function(){i&&clearTimeout(i),i=setTimeout(function(){var a=t(window).scrollTop();e.each(function(){var e=t(this);e.offset().top<window.innerHeight+a&&(e.attr("src",e.data("src")),e.removeClass("lazy"))}),0==e.length&&(t(document).off("scroll",s),t(window).off("resize",s),t(window).off("orientationChange",s))},20)};t(document).on("scroll",s),t(window).on("resize",s),t(window).on("orientationChange",s)}},searchTemplatesKit:function(a,i){var s=t(".jltma-templates-kit-price-filter").children().first().attr("data-price"),n="mixed"===s?"":'[data-price*="'+s+'"]';""!==a?(t(".main-grid .grid-item").hide(),t('.main-grid .grid-item[data-tags*="'+a+'"]'+n).show()):(t(".main-grid").html(i),t(".main-grid .grid-item"+n).show()),t(".main-grid .grid-item").is(":visible")?(t(".jltma-templates-kit-not-found").hide(),t(".jltma-templates-kit-page-title").show()):(t(".jltma-templates-kit-page-title").hide(),t(".jltma-templates-kit-not-found").css("display","flex")),t(".main-grid .grid-item:visible").each(function(e){""!==a&&-1===t(this).attr("data-title").indexOf(a)&&t(".main-grid").append(t(this).remove())}),e.initializeLazyLoading()},fiterFreeProTemplates:function(e){var a=t(".jltma-templates-kit-search").find("input").val(),i=""===a?"":'[data-tags*="'+a+'"]';"free"==e||"pro"==e?(t(".main-grid .grid-item").hide(),t('.main-grid .grid-item[data-price*="'+e+'"]'+i).show()):t(".main-grid .grid-item"+i).show()},showKitTemplates:function(a){if(a){var i=t(".jltma-kit-templates-list"),s=t(".template-pages-grid");i.show(),s.html('<div class="loading-templates"><p>Loading template pages...</p></div>'),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_get_kit_templates",kit_id:a,_wpnonce:JLTMATemplatesKitLoc.cache_nonce},success:function(t){t.success&&t.data.templates?e.renderKitTemplates(t.data.templates,a):s.html('<div class="no-templates"><p>No templates found in this kit.</p></div>')},error:function(t,e,a){console.error("Failed to load kit templates:",a),s.html('<div class="error-loading"><p>Failed to load templates. Please try again.</p></div>')}})}else console.error("Kit ID is required")},renderKitTemplates:function(a,i){var s=t(".template-pages-grid"),n="";a.forEach(function(t){n+='                    <div class="template-page-item" data-template-id="'+t.template_id+'" data-kit-id="'+i+'">                        <div class="template-checkbox-wrapper">                            <input type="checkbox" class="template-item-checkbox" data-template-slug="'+t.slug+'" data-template-title="'+t.title+'" />                        </div>                        <div class="template-preview">                            <img src="'+JLTMATemplateLibrary.plugin_url+'/assets/images/placeholder.png" data-src="'+t.thumbnail+'" alt="'+t.title+'" />                            <div class="template-overlay">                                <div class="template-actions">                                    <button class="import-single-template" data-template-slug="'+t.slug+'" data-template-title="'+t.title+'" data-kit-id="'+i+'">                                        <span class="dashicons dashicons-download"></span>                                        Import                                    </button>                                </div>                            </div>                        </div>                        <div class="template-info">                            <h4>'+t.title+'</h4>                            <p class="template-type">'+t.type.charAt(0).toUpperCase()+t.type.slice(1)+"</p>                        </div>                    </div>                "}),s.html(n),t(document).off("click",".import-single-template").on("click",".import-single-template",function(){var a=t(this),i=a.data("template-slug"),s=a.data("template-title"),n=a.data("kit-id");e.importIndividualTemplate(n,i,s,a)})},updateSelectedCount:function(){var e=t(".template-item-checkbox:checked").length,a=t(".template-item-checkbox").length;t(".selected-count").text(e+" selected");var i=t(".import-selected");e>0?i.prop("disabled",!1):i.prop("disabled",!0);var s=t("#select-all-templates");0===e?(s.prop("indeterminate",!1),s.prop("checked",!1)):e===a?(s.prop("indeterminate",!1),s.prop("checked",!0)):s.prop("indeterminate",!0)},importSelectedTemplates:function(){var a=[];if(t(".template-item-checkbox:checked").each(function(){var e=t(this);a.push({slug:e.data("template-slug"),title:e.data("template-title"),kitId:e.closest(".template-page-item").data("kit-id")})}),0!==a.length){if(confirm("Import "+a.length+" selected template(s)?\n\nThis will create new pages in your WordPress site.")){var i=t(".import-selected"),s=i.html();i.prop("disabled",!0).html('<span class="dashicons dashicons-update"></span> Importing...');var n=0,l=0;!function o(r){if(r>=a.length){var p="Import completed!\n\n";return p+="Successfully imported: "+n+" templates\n",l>0&&(p+="Failed: "+l+" templates"),alert(p),i.prop("disabled",!1).html(s),t(".template-item-checkbox").prop("checked",!1),t("#select-all-templates").prop("checked",!1),void e.updateSelectedCount()}var c=a[r];i.html('<span class="dashicons dashicons-update"></span> Importing... ('+(r+1)+"/"+a.length+")"),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_import_single_template",kit_id:c.kitId,template_slug:c.slug,template_title:c.title,_wpnonce:JLTMATemplatesKitLoc.cache_nonce},success:function(t){t.success?n++:(l++,console.error("Failed to import "+c.title+":",t.data.message)),setTimeout(function(){o(r+1)},500)},error:function(t,e,a){l++,console.error("Error importing "+c.title+":",a),setTimeout(function(){o(r+1)},500)}})}(0)}}else alert("Please select at least one template to import.")},importIndividualTemplate:function(e,a,i,s){if(confirm('Import "'+i+'" template?\n\nThis will create a new page in your WordPress site.')){var n=s.html();s.prop("disabled",!0).html('<span class="dashicons dashicons-update"></span>'),t.ajax({type:"POST",url:ajaxurl,data:{action:"jltma_import_single_template",kit_id:e,template_slug:a,template_title:i,_wpnonce:JLTMATemplatesKitLoc.cache_nonce},success:function(t){s.prop("disabled",!1).html(n),t.success?(alert('Template "'+i+'" imported successfully!\n\nYou can now edit it in Elementor.'),t.data.edit_url&&confirm("Would you like to edit the imported template now?")&&window.open(t.data.edit_url,"_blank")):alert("Failed to import template: "+(t.data.message||"Unknown error"))},error:function(t,e,a){s.prop("disabled",!1).html(n),console.error("Import error:",a),alert("Failed to import template. Please try again.")}})}},initializeInfiniteScroll:function(){var a=t(window),i=t(document),s=t('<div class="jltma-loading-more-templates" style="text-align: center; padding: 20px; display: none;"><p>Loading More Templates...</p></div>');t(".jltma-loading-more-templates").length||t(".jltma-templates-kit-grid.main-grid").after(s),a.off("scroll.jltma-infinite").on("scroll.jltma-infinite",function(){if(!e.isLoading&&e.hasMoreTemplates){var t=a.height(),s=i.height();a.scrollTop()+t>=s-500&&e.loadMoreTemplates()}})},loadMoreTemplates:function(){!e.isLoading&&e.hasMoreTemplates&&(e.isLoading=!0,e.currentPage++)},appendTemplateKits:function(a){var i=t(".jltma-templates-kit-grid.main-grid");a.forEach(function(t){var e=t.is_pro?"pro":"free",a=t.is_expert?"true":"false",s=t.tags?t.tags.join(","):"",n=t.templates?t.templates.map(function(t){return t.title}).join(","):"",l='                    <div class="grid-item" data-kit-id="'+t.kit_id+'" data-price="'+e+'" data-expert="'+a+'" data-tags="'+s+'" data-title="'+t.kit_name.toLowerCase()+'" data-pages="'+n+'">                        <div class="image-wrap">                            <img class="lazy" src="'+JLTMATemplateLibrary.plugin_url+'/assets/images/placeholder.png" data-src="'+(t.thumbnail||JLTMATemplateLibrary.plugin_url+"/assets/images/placeholder.png")+'" alt="'+t.kit_name+'" />                            <div class="image-overlay">                                <span class="dashicons dashicons-visibility"></span>                            </div>                        </div>                        <footer>                            <h3>'+t.kit_name+"</h3>                        </footer>                    </div>                ";i.append(l)}),e.initializeLazyLoading()}};e.init()});
//# sourceMappingURL=jltma-templates-kit.js.map